<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Data manipulation with &#39;tidyr&#39; and &#39;reshape2&#39; : A lesson in R for the SFU study group">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Data manipulation with &#39;tidyr&#39; and &#39;reshape2&#39;</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/remi-daigle/tidyr_reshape2_lesson">View on GitHub</a>

          <h1 id="project_title">Data manipulation with &#39;tidyr&#39; and &#39;reshape2&#39;</h1>
          <h2 id="project_tagline">A lesson in R for the SFU study group</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/remi-daigle/tidyr_reshape2_lesson/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/remi-daigle/tidyr_reshape2_lesson/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>First install the packages if you haven't already done so:</p>

<pre><code>if (!require("tidyr")) install.packages("tidyr")
if (!require("reshape2")) install.packages("reshape2")
if (!require("plyr")) install.packages("plyr")
</code></pre>

<h2>
<a id="load-the-packages" class="anchor" href="#load-the-packages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Load the packages</h2>

<pre><code>library("tidyr")
library("reshape2")
library("plyr")
</code></pre>

<h2>
<a id="loading-the-data" class="anchor" href="#loading-the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loading the data</h2>

<p>Load the data, we're using the inflammation data from the <a href="https://github.com/swcarpentry/r-novice-inflammation">Software Carpentry novice R lessons</a></p>

<pre><code>data &lt;- read.csv("inflammation-01.csv", header=FALSE)
</code></pre>

<p>Each row in this data represents a patient and columns represent measurements of inflammation over time.</p>

<pre><code>dim(data)
</code></pre>

<p>Lets put some more informative labels on this dataframe:</p>

<pre><code>names(data) &lt;- c(paste0("day_", 1:40))
head(data)
</code></pre>

<p>Lets add patient IDs. Yes the method below is a bit more complicated than it needs to be for now, but the patientID's position will be important later</p>

<pre><code>patientID &lt;- c(1:60)
data &lt;- cbind(patientID, data)
head(data)
</code></pre>

<p>Now the dataframe is human-friendly, but what happens if we need to run an analysis with all the inflammation values in 1 column? (e.g. repeated measures ANOVA)
Another motivation is to have data that meets the basic tenants of well organized "tidy" data where:</p>

<ul>
<li>each column is a variable</li>
<li>each row is an observation</li>
</ul>

<p>To meet these criteria, our dataframe should have 3 columns (variables): patientID, day, and inflammation
We could use some "brute-force" coding to re-organize the data, but that's encouraging mistakes
With the reshape2 or tidyr packages, we have the tools to easily re-organize our data</p>

<h2>
<a id="reshape2melt" class="anchor" href="#reshape2melt" aria-hidden="true"><span class="octicon octicon-link"></span></a>reshape2::melt()</h2>

<p>First, lets try melt() from the reshape2 package:</p>

<pre><code>reshaped_data &lt;- melt(data)
head(reshaped_data)
tail(reshaped_data)
</code></pre>

<p>This is not quite what we needed, melt() took all the columns and treated them equally because we didn't tell it that patientID is an important id variable
Lets try that again but this time specify the id variables</p>

<pre><code>reshaped_data &lt;- melt(data, id.vars = "patientID")
head(reshaped_data)
</code></pre>

<p>What if we had some other information about the patients that we think may be important?
Let's assume that each patient was given 1 of 3 different drugs. Again, this is a bit more complicated than it needs to be for now, but the drug's position will be important later</p>

<pre><code>drugs &lt;- rep(c("A", "B", "C"), each = 20)
data &lt;- as.data.frame(append(data, list(drug = drugs), after = 1))
head(data)
</code></pre>

<p>We now need to specify both patientID and drug as id variables</p>

<pre><code>reshaped_data &lt;- melt(data, id.vars = c("patientID", "drug"))
head(reshaped_data)
tail(reshaped_data)
</code></pre>

<p>The variables named patientID and drug are descriptive, but variable and value are not. We can fix that in melt() </p>

<pre><code>reshaped_data &lt;- melt(data, id.vars = c("patientID", "drug"), variable.name = "day", value.name = "inflammation")
</code></pre>

<p>You can also manipulate data that is in 1 variable. In this data, we might want to seperate the numeric 'day' value from 'day_'. This would be particularly useful if the time units were not consistent (i.e. some as 'day_x' and some as 'week_x')</p>

<pre><code>day_splits &lt;- colsplit(reshaped_data$day, "_", c("unit_time", "time"))
head(day_splits)
</code></pre>

<h2>
<a id="reshape2dcast" class="anchor" href="#reshape2dcast" aria-hidden="true"><span class="octicon octicon-link"></span></a>reshape2::dcast()</h2>

<p>Now if for some reason, you did not keep the original data (e.g. hard-drive failure?) and you need the data with the original formatting back (e.g. if your colleague will only work with it in that format), we can easily re-organize the data back to the original format</p>

<pre><code>unreshaped_data &lt;- dcast(reshaped_data, patientID+drug~day, value.var='inflammation')
</code></pre>

<p>A brief note on the syntax here; the value variable that gets broken up is inflammation (the column with all the inflammation values). The new column names for the 'inflammation' values comes from the 'day' column (on the right side of the ~) and the id variables (patientID+drug) are on the right side of the '~' seperated by '+'</p>

<p>Let's double-check that we didn't mess anything up along the way:</p>

<pre><code>identical(data,unreshaped_data)
</code></pre>

<h2>
<a id="tidyrgather" class="anchor" href="#tidyrgather" aria-hidden="true"><span class="octicon octicon-link"></span></a>tidyr::gather()</h2>

<p>The tidyr package does the same kinds of things albeit with different syntax. This is similar to melt(), it will reorganize your data in the 'long' format. Note that in this case, the ID variables (patientID and drug are left out)</p>

<p>tidied_data &lt;- gather(data, day, inflammation, day_1:day_40)
head(tidied_data)
identical(tidied_data, reshaped_data)</p>

<p>Gather also allows the alternative syntax of using the '-' symbol to identify which variables are not to be gathered (i.e. ID variables)</p>

<pre><code>tidied_data &lt;- gather(data, day, inflammation, -patientID, -drug)
head(tidied_data)
identical(tidied_data, reshaped_data)
</code></pre>

<h2>
<a id="tidyrseparate" class="anchor" href="#tidyrseparate" aria-hidden="true"><span class="octicon octicon-link"></span></a>tidyr::separate()</h2>

<p>Similar to <code>colsplit()</code>, <code>separate()</code> will split a variable into multiple</p>

<pre><code>day_splits &lt;- separate(tidied_data, day, c("unit_time","time"), sep="_")
</code></pre>

<h2>
<a id="tidyrspread" class="anchor" href="#tidyrspread" aria-hidden="true"><span class="octicon octicon-link"></span></a>tidyr::spread()</h2>

<p>The tidyr package does the same kinds of things albeit with different syntax</p>

<pre><code>untidied_data &lt;- spread(tidied_data,day, inflammation)
head(untidied_data)

identical(untidied_data, data)
identical(untidied_data, unreshaped_data)
</code></pre>

<h2>
<a id="side-by-side-comparison" class="anchor" href="#side-by-side-comparison" aria-hidden="true"><span class="octicon octicon-link"></span></a>Side by side comparison</h2>

<p>Tidyr is designed specifically to tidy dataframes while reshape2 is a bit more for general reshaping</p>

<p>They seem to be roughly equally efficient computationally</p>

<pre><code>data_big &lt;- rbind.fill(replicate(10000, data, simplify = FALSE))

system.time(melt(data_big, id.vars=c("patientID","drug"), variable.name="day", value.name="inflammation"))
system.time(gather(data_big, day, inflammation, day_1:day_40))
</code></pre>

<p>Reshape allows functions which is useful when id variables are not unique. Here we calculate the mean inflammation for each drug</p>

<pre><code>means_drug &lt;- dcast( reshaped_data, drug ~ day, value.var="inflammation", fun.aggregate = mean)
head(means_drug)
</code></pre>

<p>You can also use dcast's sybling acast() to get an array instead of a dataframe</p>

<pre><code>unreshaped_data_array &lt;- acast(reshaped_data, patientID+drug~day, value.var='inflammation')
</code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Data manipulation with &#39;tidyr&#39; and &#39;reshape2&#39; maintained by <a href="https://github.com/remi-daigle">remi-daigle</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-50638009-3");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
